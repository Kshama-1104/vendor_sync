<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Queue - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #4f46e5;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
        }

        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .navbar {
            background: var(--card-bg) !important;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
        }

        .navbar-brand i {
            color: var(--primary-color);
        }

        .sidebar {
            background: var(--card-bg);
            min-height: calc(100vh - 56px);
            border-right: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar .nav-link {
            color: var(--text-secondary);
            padding: 12px 20px;
            border-radius: 8px;
            margin: 4px 12px;
            transition: all 0.3s ease;
        }

        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: var(--text-primary);
            background: rgba(99, 102, 241, 0.2);
        }

        .sidebar .nav-link i {
            width: 24px;
            margin-right: 10px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-icon.queues { background: rgba(99, 102, 241, 0.2); color: var(--primary-color); }
        .stat-icon.messages { background: rgba(16, 185, 129, 0.2); color: var(--success-color); }
        .stat-icon.workers { background: rgba(245, 158, 11, 0.2); color: var(--warning-color); }
        .stat-icon.errors { background: rgba(239, 68, 68, 0.2); color: var(--danger-color); }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 10px 0;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .content-card {
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.1);
            overflow: hidden;
        }

        .content-card .card-header {
            background: transparent;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 20px 24px;
        }

        .content-card .card-body {
            padding: 24px;
        }

        .queue-item {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.3s ease;
        }

        .queue-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .queue-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 12px;
        }

        .queue-status.active { background: var(--success-color); }
        .queue-status.paused { background: var(--warning-color); }
        .queue-status.error { background: var(--danger-color); }

        .btn-primary {
            background: var(--primary-color);
            border-color: var(--primary-color);
            border-radius: 8px;
            padding: 10px 20px;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .health-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .health-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .health-dot.healthy { background: var(--success-color); }
        .health-dot.unhealthy { background: var(--danger-color); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 14px;
        }

        .activity-icon.publish { background: rgba(99, 102, 241, 0.2); color: var(--primary-color); }
        .activity-icon.consume { background: rgba(16, 185, 129, 0.2); color: var(--success-color); }
        .activity-icon.error { background: rgba(239, 68, 68, 0.2); color: var(--danger-color); }

        .modal-content {
            background: var(--card-bg);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .form-control, .form-select {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-primary);
            border-radius: 8px;
            padding: 12px 16px;
        }

        .form-control:focus, .form-select:focus {
            background: rgba(255,255,255,0.1);
            border-color: var(--primary-color);
            color: var(--text-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .table {
            color: var(--text-primary);
        }

        .table thead th {
            border-bottom-color: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1px;
        }

        .table tbody td {
            border-bottom-color: rgba(255,255,255,0.05);
            vertical-align: middle;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 500;
        }

        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background: var(--card-bg);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-layer-group me-2"></i>Cloud Queue
            </a>
            <div class="d-flex align-items-center">
                <div class="health-indicator me-4">
                    <span class="health-dot healthy" id="healthDot"></span>
                    <span id="healthStatus">Connected</span>
                </div>
                <span class="text-secondary me-3" id="serverTime"></span>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar p-0">
                <nav class="nav flex-column py-3">
                    <a class="nav-link active" href="#" data-page="dashboard">
                        <i class="fas fa-chart-line"></i> Dashboard
                    </a>
                    <a class="nav-link" href="#" data-page="queues">
                        <i class="fas fa-inbox"></i> Queues
                    </a>
                    <a class="nav-link" href="#" data-page="messages">
                        <i class="fas fa-envelope"></i> Messages
                    </a>
                    <a class="nav-link" href="#" data-page="workers">
                        <i class="fas fa-cogs"></i> Workers
                    </a>
                    <a class="nav-link" href="#" data-page="metrics">
                        <i class="fas fa-chart-bar"></i> Metrics
                    </a>
                    <a class="nav-link" href="#" data-page="settings">
                        <i class="fas fa-gear"></i> Settings
                    </a>
                </nav>
            </div>

            <!-- Main Content -->
            <div class="col-md-10 p-4">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page-content">
                    <h4 class="mb-4">Dashboard Overview</h4>
                    
                    <!-- Stats Row -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="stat-icon queues">
                                    <i class="fas fa-inbox"></i>
                                </div>
                                <div class="stat-value" id="totalQueues">0</div>
                                <div class="stat-label">Total Queues</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="stat-icon messages">
                                    <i class="fas fa-envelope"></i>
                                </div>
                                <div class="stat-value" id="totalMessages">0</div>
                                <div class="stat-label">Messages</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="stat-icon workers">
                                    <i class="fas fa-cogs"></i>
                                </div>
                                <div class="stat-value" id="activeWorkers">0</div>
                                <div class="stat-label">Active Workers</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="stat-icon errors">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="stat-value" id="failedMessages">0</div>
                                <div class="stat-label">Failed Messages</div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Queues Overview -->
                        <div class="col-md-8">
                            <div class="content-card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0"><i class="fas fa-inbox me-2"></i>Queues</h5>
                                    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#createQueueModal">
                                        <i class="fas fa-plus me-1"></i> Create Queue
                                    </button>
                                </div>
                                <div class="card-body" id="queuesContainer">
                                    <div class="queue-item">
                                        <div class="d-flex align-items-center">
                                            <span class="queue-status active"></span>
                                            <div>
                                                <strong>default-queue</strong>
                                                <div class="text-secondary small">Standard Queue • 0 messages</div>
                                            </div>
                                        </div>
                                        <div>
                                            <span class="badge bg-success">Active</span>
                                        </div>
                                    </div>
                                    <div class="queue-item">
                                        <div class="d-flex align-items-center">
                                            <span class="queue-status active"></span>
                                            <div>
                                                <strong>priority-queue</strong>
                                                <div class="text-secondary small">Priority Queue • 0 messages</div>
                                            </div>
                                        </div>
                                        <div>
                                            <span class="badge bg-success">Active</span>
                                        </div>
                                    </div>
                                    <div class="queue-item">
                                        <div class="d-flex align-items-center">
                                            <span class="queue-status paused"></span>
                                            <div>
                                                <strong>delay-queue</strong>
                                                <div class="text-secondary small">Delay Queue • 0 messages</div>
                                            </div>
                                        </div>
                                        <div>
                                            <span class="badge bg-warning text-dark">Paused</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="col-md-4">
                            <div class="content-card">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-clock me-2"></i>Recent Activity</h5>
                                </div>
                                <div class="card-body" id="activityContainer">
                                    <div class="activity-item">
                                        <div class="activity-icon publish">
                                            <i class="fas fa-paper-plane"></i>
                                        </div>
                                        <div>
                                            <strong>Message Published</strong>
                                            <div class="text-secondary small">default-queue • Just now</div>
                                        </div>
                                    </div>
                                    <div class="activity-item">
                                        <div class="activity-icon consume">
                                            <i class="fas fa-check"></i>
                                        </div>
                                        <div>
                                            <strong>Message Consumed</strong>
                                            <div class="text-secondary small">priority-queue • 2 min ago</div>
                                        </div>
                                    </div>
                                    <div class="activity-item">
                                        <div class="activity-icon publish">
                                            <i class="fas fa-paper-plane"></i>
                                        </div>
                                        <div>
                                            <strong>Queue Created</strong>
                                            <div class="text-secondary small">delay-queue • 5 min ago</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- System Info -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="content-card">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-server me-2"></i>System Information</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="text-secondary small">Server Uptime</div>
                                            <div class="h5" id="uptime">0s</div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="text-secondary small">Environment</div>
                                            <div class="h5">Development</div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="text-secondary small">API Version</div>
                                            <div class="h5">v1.0.0</div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="text-secondary small">Node.js</div>
                                            <div class="h5">v18+</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Queues Page -->
                <div id="queues-page" class="page-content" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4>Queue Management</h4>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createQueueModal">
                            <i class="fas fa-plus me-2"></i>Create Queue
                        </button>
                    </div>
                    <div class="content-card">
                        <div class="card-body">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Messages</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="queuesTable">
                                    <tr>
                                        <td><strong>default-queue</strong></td>
                                        <td>Standard</td>
                                        <td>0</td>
                                        <td><span class="badge bg-success">Active</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary me-1"><i class="fas fa-eye"></i></button>
                                            <button class="btn btn-sm btn-outline-warning me-1"><i class="fas fa-pause"></i></button>
                                            <button class="btn btn-sm btn-outline-danger"><i class="fas fa-trash"></i></button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>priority-queue</strong></td>
                                        <td>Priority</td>
                                        <td>0</td>
                                        <td><span class="badge bg-success">Active</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary me-1"><i class="fas fa-eye"></i></button>
                                            <button class="btn btn-sm btn-outline-warning me-1"><i class="fas fa-pause"></i></button>
                                            <button class="btn btn-sm btn-outline-danger"><i class="fas fa-trash"></i></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Messages Page -->
                <div id="messages-page" class="page-content" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4>Message Center</h4>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#publishMessageModal">
                            <i class="fas fa-paper-plane me-2"></i>Publish Message
                        </button>
                    </div>
                    <div class="content-card">
                        <div class="card-body">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Queue</th>
                                        <th>Body</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                    </tr>
                                </thead>
                                <tbody id="messagesTable">
                                    <tr>
                                        <td colspan="5" class="text-center text-secondary">No messages found</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Workers Page -->
                <div id="workers-page" class="page-content" style="display: none;">
                    <h4 class="mb-4">Worker Management</h4>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="stat-card">
                                <div class="stat-icon workers">
                                    <i class="fas fa-cogs"></i>
                                </div>
                                <div class="stat-value">0</div>
                                <div class="stat-label">Active Workers</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-card">
                                <div class="stat-icon messages">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="stat-value">0</div>
                                <div class="stat-label">Processed Today</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-card">
                                <div class="stat-icon errors">
                                    <i class="fas fa-times-circle"></i>
                                </div>
                                <div class="stat-value">0</div>
                                <div class="stat-label">Failed Today</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Metrics Page -->
                <div id="metrics-page" class="page-content" style="display: none;">
                    <h4 class="mb-4">Metrics & Monitoring</h4>
                    <div class="content-card">
                        <div class="card-header">
                            <h5 class="mb-0">System Metrics</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Throughput</h6>
                                    <div class="progress mb-3" style="height: 25px;">
                                        <div class="progress-bar bg-primary" style="width: 45%;">450 msg/min</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6>Queue Depth</h6>
                                    <div class="progress mb-3" style="height: 25px;">
                                        <div class="progress-bar bg-success" style="width: 20%;">200 messages</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div id="settings-page" class="page-content" style="display: none;">
                    <h4 class="mb-4">Settings</h4>
                    <div class="content-card">
                        <div class="card-body">
                            <form>
                                <div class="mb-3">
                                    <label class="form-label">API Endpoint</label>
                                    <input type="text" class="form-control" value="http://localhost:3000/api/v1" readonly>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Rate Limit (requests/min)</label>
                                    <input type="number" class="form-control" value="1000">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Default Retention (days)</label>
                                    <input type="number" class="form-control" value="7">
                                </div>
                                <button type="button" class="btn btn-primary">Save Settings</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Queue Modal -->
    <div class="modal fade" id="createQueueModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Queue</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createQueueForm">
                        <div class="mb-3">
                            <label class="form-label">Queue Name</label>
                            <input type="text" class="form-control" id="queueName" required placeholder="my-queue">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Queue Type</label>
                            <select class="form-select" id="queueType">
                                <option value="standard">Standard</option>
                                <option value="priority">Priority</option>
                                <option value="delay">Delay</option>
                                <option value="fifo">FIFO</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Max Size</label>
                            <input type="number" class="form-control" id="maxSize" value="10000">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="createQueueBtn">Create Queue</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Publish Message Modal -->
    <div class="modal fade" id="publishMessageModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Publish Message</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="publishMessageForm">
                        <div class="mb-3">
                            <label class="form-label">Select Queue</label>
                            <select class="form-select" id="messageQueue">
                                <option value="default-queue">default-queue</option>
                                <option value="priority-queue">priority-queue</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Message Body</label>
                            <textarea class="form-control" id="messageBody" rows="4" placeholder='{"key": "value"}'></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Priority (optional)</label>
                            <input type="number" class="form-control" id="messagePriority" min="1" max="10" placeholder="1-10">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="publishMessageBtn">Publish</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script>
        // API Base URL
        const API_BASE = '/api/v1';
        
        // Socket.io connection
        let socket;
        try {
            socket = io();
            socket.on('connect', () => {
                console.log('Socket connected');
            });
        } catch (e) {
            console.log('Socket.io not available');
        }

        // Page navigation
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const page = e.currentTarget.dataset.page;
                
                // Update active state
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                e.currentTarget.classList.add('active');
                
                // Show page
                document.querySelectorAll('.page-content').forEach(p => p.style.display = 'none');
                document.getElementById(`${page}-page`).style.display = 'block';
            });
        });

        // Health check
        async function checkHealth() {
            try {
                const response = await fetch('/health');
                const data = await response.json();
                
                document.getElementById('healthDot').className = 'health-dot healthy';
                document.getElementById('healthStatus').textContent = 'Connected';
                document.getElementById('uptime').textContent = formatUptime(data.uptime);
            } catch (error) {
                document.getElementById('healthDot').className = 'health-dot unhealthy';
                document.getElementById('healthStatus').textContent = 'Disconnected';
            }
        }

        // Load system metrics
        async function loadSystemMetrics() {
            try {
                const response = await fetch(`${API_BASE}/metrics/system`, {
                    headers: { 'x-api-key': 'demo-api-key' }
                });
                const data = await response.json();
                if (data.success) {
                    document.getElementById('totalQueues').textContent = data.data.queues.total || 0;
                    document.getElementById('activeWorkers').textContent = data.data.workers.activeWorkers || 0;
                    document.getElementById('totalMessages').textContent = data.data.queues.totalDepth || 0;
                }
            } catch (error) {
                console.error('Failed to load system metrics:', error);
            }
        }

        // Format uptime
        function formatUptime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            if (hrs > 0) return `${hrs}h ${mins}m ${secs}s`;
            if (mins > 0) return `${mins}m ${secs}s`;
            return `${secs}s`;
        }

        // Update server time
        function updateServerTime() {
            document.getElementById('serverTime').textContent = new Date().toLocaleTimeString();
        }

        // Load queues
        async function loadQueues() {
            try {
                const response = await fetch(`${API_BASE}/queues`, {
                    headers: { 'x-api-key': 'demo-api-key' }
                });
                const data = await response.json();
                if (data.success && data.data.data) {
                    const queues = data.data.data;
                    const container = document.getElementById('queuesContainer');
                    const tableBody = document.getElementById('queuesTable');
                    const messageQueueSelect = document.getElementById('messageQueue');
                    
                    // Clear existing content
                    container.innerHTML = '';
                    tableBody.innerHTML = '';
                    messageQueueSelect.innerHTML = '';
                    
                    queues.forEach(queue => {
                        // Dashboard queue item
                        const queueItem = document.createElement('div');
                        queueItem.className = 'queue-item';
                        queueItem.innerHTML = `
                            <div class="d-flex align-items-center">
                                <span class="queue-status ${queue.paused ? 'paused' : 'active'}"></span>
                                <div>
                                    <strong>${queue.name}</strong>
                                    <div class="text-secondary small">${queue.type} Queue • ${queue.depth || 0} messages</div>
                                </div>
                            </div>
                            <div>
                                <span class="badge bg-${queue.paused ? 'warning text-dark' : 'success'}">${queue.paused ? 'Paused' : 'Active'}</span>
                            </div>
                        `;
                        container.appendChild(queueItem);
                        
                        // Table row
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td><strong>${queue.name}</strong></td>
                            <td>${queue.type}</td>
                            <td>${queue.depth || 0}</td>
                            <td><span class="badge bg-${queue.paused ? 'warning text-dark' : 'success'}">${queue.paused ? 'Paused' : 'Active'}</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="viewQueue('${queue.name}')"><i class="fas fa-eye"></i></button>
                                <button class="btn btn-sm btn-outline-warning me-1" onclick="toggleQueue('${queue.name}', ${!queue.paused})"><i class="fas fa-${queue.paused ? 'play' : 'pause'}"></i></button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteQueue('${queue.name}')"><i class="fas fa-trash"></i></button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                        
                        // Select option
                        const option = document.createElement('option');
                        option.value = queue.name;
                        option.textContent = queue.name;
                        messageQueueSelect.appendChild(option);
                    });
                    
                    document.getElementById('totalQueues').textContent = queues.length;
                }
            } catch (error) {
                console.error('Failed to load queues:', error);
            }
        }

        // View queue details
        async function viewQueue(name) {
            alert(`Queue: ${name}\nView detailed information coming soon!`);
        }

        // Toggle queue pause/resume
        async function toggleQueue(name, pause) {
            try {
                const action = pause ? 'pause' : 'resume';
                const response = await fetch(`${API_BASE}/queues/${name}/${action}`, {
                    method: 'POST',
                    headers: { 'x-api-key': 'demo-api-key' }
                });
                const data = await response.json();
                if (data.success) {
                    loadQueues();
                } else {
                    alert('Error: ' + data.error.message);
                }
            } catch (error) {
                alert('Failed to toggle queue: ' + error.message);
            }
        }

        // Delete queue
        async function deleteQueue(name) {
            if (!confirm(`Are you sure you want to delete queue "${name}"?`)) return;
            try {
                const response = await fetch(`${API_BASE}/queues/${name}`, {
                    method: 'DELETE',
                    headers: { 'x-api-key': 'demo-api-key' }
                });
                const data = await response.json();
                if (data.success) {
                    loadQueues();
                } else {
                    alert('Error: ' + data.error.message);
                }
            } catch (error) {
                alert('Failed to delete queue: ' + error.message);
            }
        }

        // Create queue
        document.getElementById('createQueueBtn').addEventListener('click', async () => {
            const name = document.getElementById('queueName').value;
            const type = document.getElementById('queueType').value;
            const maxSize = document.getElementById('maxSize').value;

            if (!name) {
                alert('Please enter a queue name');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/queues`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': 'demo-api-key'
                    },
                    body: JSON.stringify({ name, type, maxSize: parseInt(maxSize) })
                });

                const data = await response.json();
                if (data.success) {
                    alert('Queue created successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('createQueueModal')).hide();
                    document.getElementById('queueName').value = '';
                    loadQueues();
                } else {
                    alert('Error: ' + data.error.message);
                }
            } catch (error) {
                alert('Failed to create queue: ' + error.message);
            }
        });

        // Publish message
        document.getElementById('publishMessageBtn').addEventListener('click', async () => {
            const queue = document.getElementById('messageQueue').value;
            const bodyText = document.getElementById('messageBody').value;
            const priority = document.getElementById('messagePriority').value;

            if (!queue) {
                alert('Please select a queue');
                return;
            }
            if (!bodyText) {
                alert('Please enter a message body');
                return;
            }

            let body;
            try {
                body = JSON.parse(bodyText);
            } catch (e) {
                body = bodyText; // Use as plain text if not valid JSON
            }

            try {
                const response = await fetch(`${API_BASE}/queues/${queue}/messages`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': 'demo-api-key'
                    },
                    body: JSON.stringify({ 
                        body: body,
                        priority: priority ? parseInt(priority) : undefined
                    })
                });

                const data = await response.json();
                if (data.success) {
                    alert(`Message published successfully!\nMessage ID: ${data.data.messageId}`);
                    bootstrap.Modal.getInstance(document.getElementById('publishMessageModal')).hide();
                    document.getElementById('messageBody').value = '';
                    document.getElementById('messagePriority').value = '';
                    loadQueues();
                    loadSystemMetrics();
                } else {
                    alert('Error: ' + data.error.message);
                }
            } catch (error) {
                alert('Failed to publish message: ' + error.message);
            }
        });

        // Initialize
        checkHealth();
        updateServerTime();
        loadQueues();
        loadSystemMetrics();
        setInterval(checkHealth, 5000);
        setInterval(updateServerTime, 1000);
        setInterval(loadQueues, 10000);
        setInterval(loadSystemMetrics, 10000);
    </script>
</body>
</html>
