<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ServiceFlow - Service Request Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366f1;
            --primary-dark: #4f46e5;
            --secondary-color: #8b5cf6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #06b6d4;
            --dark-color: #1f2937;
            --light-bg: #f8fafc;
        }

        body {
            background: var(--light-bg);
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        /* Sidebar */
        .sidebar {
            background: linear-gradient(180deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            min-height: 100vh;
            width: 260px;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 1000;
            transition: all 0.3s;
        }

        .sidebar-brand {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-brand h3 {
            color: white;
            font-weight: 700;
            margin: 0;
        }

        .sidebar-brand small {
            color: rgba(255,255,255,0.7);
            font-size: 0.75rem;
        }

        .sidebar-nav {
            padding: 1rem 0;
        }

        .nav-item {
            margin: 0.25rem 0.75rem;
        }

        .nav-link {
            color: rgba(255,255,255,0.8);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(255,255,255,0.15);
            color: white;
        }

        .nav-link i {
            font-size: 1.1rem;
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            padding: 1.5rem;
        }

        /* Header */
        .page-header {
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* Stats Cards */
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-icon.primary { background: rgba(99, 102, 241, 0.1); color: var(--primary-color); }
        .stat-icon.success { background: rgba(16, 185, 129, 0.1); color: var(--success-color); }
        .stat-icon.warning { background: rgba(245, 158, 11, 0.1); color: var(--warning-color); }
        .stat-icon.danger { background: rgba(239, 68, 68, 0.1); color: var(--danger-color); }
        .stat-icon.info { background: rgba(6, 182, 212, 0.1); color: var(--info-color); }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark-color);
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.875rem;
        }

        /* Cards */
        .card-custom {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: none;
        }

        .card-custom .card-header {
            background: none;
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem 1.5rem;
        }

        .card-custom .card-body {
            padding: 1.5rem;
        }

        /* Service Request Table */
        .service-table {
            margin: 0;
        }

        .service-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
            border: none;
            padding: 1rem;
        }

        .service-table td {
            padding: 1rem;
            vertical-align: middle;
            border-color: #f3f4f6;
        }

        .service-id {
            font-family: monospace;
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Status Badges */
        .status-badge {
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-draft { background: #e5e7eb; color: #374151; }
        .status-submitted { background: #dbeafe; color: #1d4ed8; }
        .status-pending_approval { background: #fef3c7; color: #92400e; }
        .status-approved { background: #d1fae5; color: #065f46; }
        .status-rejected { background: #fee2e2; color: #991b1b; }
        .status-in_progress { background: #e0e7ff; color: #3730a3; }
        .status-completed { background: #d1fae5; color: #065f46; }
        .status-cancelled { background: #f3f4f6; color: #6b7280; }

        /* Priority Badges */
        .priority-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-critical { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
        .priority-high { background: #fff7ed; color: #ea580c; border: 1px solid #fed7aa; }
        .priority-medium { background: #fefce8; color: #ca8a04; border: 1px solid #fef08a; }
        .priority-low { background: #f0fdf4; color: #16a34a; border: 1px solid #bbf7d0; }

        /* SLA Progress */
        .sla-progress {
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
        }

        .sla-progress-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s;
        }

        .sla-safe { background: var(--success-color); }
        .sla-warning { background: var(--warning-color); }
        .sla-danger { background: var(--danger-color); }

        /* Action Buttons */
        .btn-action {
            padding: 0.35rem 0.5rem;
            border-radius: 6px;
            font-size: 0.875rem;
        }

        /* Modal */
        .modal-content {
            border-radius: 16px;
            border: none;
        }

        .modal-header {
            border-bottom: 1px solid #e5e7eb;
            padding: 1.25rem 1.5rem;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            border-top: 1px solid #e5e7eb;
            padding: 1rem 1.5rem;
        }

        /* Form Controls */
        .form-control, .form-select {
            border-radius: 8px;
            padding: 0.625rem 0.875rem;
            border: 1px solid #d1d5db;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-label {
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.5rem;
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 2rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e5e7eb;
        }

        .timeline-item {
            position: relative;
            padding-bottom: 1.5rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -1.6rem;
            top: 0.25rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary-color);
            border: 2px solid white;
        }

        .timeline-item.success::before { background: var(--success-color); }
        .timeline-item.warning::before { background: var(--warning-color); }
        .timeline-item.danger::before { background: var(--danger-color); }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 9999;
        }

        /* Workflow Diagram */
        .workflow-step {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            position: relative;
        }

        .workflow-step.active {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.05);
        }

        .workflow-step.completed {
            border-color: var(--success-color);
            background: rgba(16, 185, 129, 0.05);
        }

        .workflow-arrow {
            color: #9ca3af;
            font-size: 1.5rem;
        }

        /* Quick Actions */
        .quick-action-btn {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            transition: all 0.2s;
            cursor: pointer;
        }

        .quick-action-btn:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .quick-action-btn i {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        /* Approver Avatar */
        .approver-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
        }

        /* Loading Spinner */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .spinner-custom {
            width: 48px;
            height: 48px;
            border: 4px solid #e5e7eb;
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 0;
                overflow: hidden;
            }
            .sidebar.show {
                width: 260px;
            }
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-brand">
            <h3><i class="bi bi-diagram-3"></i> ServiceFlow</h3>
            <small>Service Request Management</small>
        </div>
        <nav class="sidebar-nav">
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link active" href="#" data-section="dashboard">
                        <i class="bi bi-speedometer2"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="services">
                        <i class="bi bi-ticket-detailed"></i> Service Requests
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="workflows">
                        <i class="bi bi-diagram-2"></i> Workflows
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="approvals">
                        <i class="bi bi-check2-circle"></i> Approvals
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="sla">
                        <i class="bi bi-clock-history"></i> SLA Monitoring
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="analytics">
                        <i class="bi bi-bar-chart"></i> Analytics
                    </a>
                </li>
                <li class="nav-item mt-3">
                    <a class="nav-link" href="#" data-section="settings">
                        <i class="bi bi-gear"></i> Settings
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section">
            <div class="page-header d-flex justify-content-between align-items-center">
                <div>
                    <h4 class="mb-1">Dashboard</h4>
                    <p class="text-muted mb-0">Overview of service requests and workflows</p>
                </div>
                <button class="btn btn-primary" onclick="showCreateServiceModal()">
                    <i class="bi bi-plus-lg"></i> New Request
                </button>
            </div>

            <!-- Stats Row -->
            <div class="row g-4 mb-4">
                <div class="col-md-6 col-lg-3">
                    <div class="stat-card">
                        <div class="d-flex justify-content-between">
                            <div>
                                <div class="stat-value" id="total-requests">0</div>
                                <div class="stat-label">Total Requests</div>
                            </div>
                            <div class="stat-icon primary">
                                <i class="bi bi-ticket-detailed"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="stat-card">
                        <div class="d-flex justify-content-between">
                            <div>
                                <div class="stat-value" id="pending-approvals">0</div>
                                <div class="stat-label">Pending Approvals</div>
                            </div>
                            <div class="stat-icon warning">
                                <i class="bi bi-hourglass-split"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="stat-card">
                        <div class="d-flex justify-content-between">
                            <div>
                                <div class="stat-value" id="in-progress">0</div>
                                <div class="stat-label">In Progress</div>
                            </div>
                            <div class="stat-icon info">
                                <i class="bi bi-arrow-repeat"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="stat-card">
                        <div class="d-flex justify-content-between">
                            <div>
                                <div class="stat-value" id="sla-compliance">0%</div>
                                <div class="stat-label">SLA Compliance</div>
                            </div>
                            <div class="stat-icon success">
                                <i class="bi bi-shield-check"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="row g-4 mb-4">
                <div class="col-12">
                    <h6 class="text-muted mb-3">Quick Actions</h6>
                </div>
                <div class="col-md-3">
                    <div class="quick-action-btn" onclick="showCreateServiceModal()">
                        <i class="bi bi-plus-circle d-block mb-2"></i>
                        <small>New Service Request</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="quick-action-btn" onclick="showSection('approvals')">
                        <i class="bi bi-check2-square d-block mb-2"></i>
                        <small>Review Approvals</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="quick-action-btn" onclick="showSection('workflows')">
                        <i class="bi bi-diagram-3 d-block mb-2"></i>
                        <small>Manage Workflows</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="quick-action-btn" onclick="showSection('analytics')">
                        <i class="bi bi-graph-up d-block mb-2"></i>
                        <small>View Analytics</small>
                    </div>
                </div>
            </div>

            <!-- Recent Requests & Activity -->
            <div class="row g-4">
                <div class="col-lg-8">
                    <div class="card-custom">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">Recent Service Requests</h6>
                            <a href="#" class="text-primary text-decoration-none" onclick="showSection('services')">View All</a>
                        </div>
                        <div class="card-body p-0">
                            <table class="table service-table mb-0">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Title</th>
                                        <th>Priority</th>
                                        <th>Status</th>
                                        <th>SLA</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="recent-requests-table">
                                    <tr>
                                        <td colspan="6" class="text-center text-muted py-4">
                                            <i class="bi bi-inbox d-block mb-2" style="font-size: 2rem;"></i>
                                            No service requests yet
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card-custom">
                        <div class="card-header">
                            <h6 class="mb-0">Recent Activity</h6>
                        </div>
                        <div class="card-body">
                            <div class="timeline" id="activity-timeline">
                                <div class="timeline-item">
                                    <small class="text-muted">System Started</small>
                                    <p class="mb-0">ServiceFlow is ready to use</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Services Section -->
        <div id="services-section" class="section d-none">
            <div class="page-header d-flex justify-content-between align-items-center">
                <div>
                    <h4 class="mb-1">Service Requests</h4>
                    <p class="text-muted mb-0">Manage all service requests</p>
                </div>
                <button class="btn btn-primary" onclick="showCreateServiceModal()">
                    <i class="bi bi-plus-lg"></i> New Request
                </button>
            </div>

            <!-- Filters -->
            <div class="card-custom mb-4">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <input type="text" class="form-control" placeholder="Search requests..." id="search-input">
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="filter-status">
                                <option value="">All Status</option>
                                <option value="draft">Draft</option>
                                <option value="submitted">Submitted</option>
                                <option value="pending_approval">Pending Approval</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                                <option value="in_progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="filter-priority">
                                <option value="">All Priority</option>
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="filter-type">
                                <option value="">All Types</option>
                                <option value="it_support">IT Support</option>
                                <option value="hr_request">HR Request</option>
                                <option value="facilities">Facilities</option>
                                <option value="procurement">Procurement</option>
                                <option value="finance">Finance</option>
                                <option value="general">General</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-outline-secondary w-100" onclick="applyFilters()">
                                <i class="bi bi-funnel"></i> Apply Filters
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Services Table -->
            <div class="card-custom">
                <div class="card-body p-0">
                    <table class="table service-table mb-0">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Type</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Requester</th>
                                <th>Created</th>
                                <th>SLA</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="services-table-body">
                            <tr>
                                <td colspan="9" class="text-center text-muted py-5">
                                    <i class="bi bi-inbox d-block mb-2" style="font-size: 3rem;"></i>
                                    No service requests found. Create your first request!
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Workflows Section -->
        <div id="workflows-section" class="section d-none">
            <div class="page-header d-flex justify-content-between align-items-center">
                <div>
                    <h4 class="mb-1">Workflows</h4>
                    <p class="text-muted mb-0">Configure approval workflows and automation</p>
                </div>
                <button class="btn btn-primary" onclick="showCreateWorkflowModal()">
                    <i class="bi bi-plus-lg"></i> New Workflow
                </button>
            </div>

            <div class="row g-4">
                <div class="col-lg-8">
                    <div class="card-custom">
                        <div class="card-header">
                            <h6 class="mb-0">Workflow Templates</h6>
                        </div>
                        <div class="card-body" id="workflows-list">
                            <!-- Demo Workflows -->
                            <div class="border rounded-3 p-3 mb-3">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="mb-1">IT Support Workflow</h6>
                                        <p class="text-muted small mb-2">3-level approval for IT support requests</p>
                                        <div class="d-flex gap-2">
                                            <span class="badge bg-success">Active</span>
                                            <span class="badge bg-light text-dark">3 Steps</span>
                                        </div>
                                    </div>
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="dropdown">
                                            <i class="bi bi-three-dots-vertical"></i>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" href="#">Edit</a></li>
                                            <li><a class="dropdown-item" href="#">Duplicate</a></li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li><a class="dropdown-item text-danger" href="#">Delete</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="border rounded-3 p-3 mb-3">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="mb-1">HR Request Workflow</h6>
                                        <p class="text-muted small mb-2">HR department approval process</p>
                                        <div class="d-flex gap-2">
                                            <span class="badge bg-success">Active</span>
                                            <span class="badge bg-light text-dark">2 Steps</span>
                                        </div>
                                    </div>
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="dropdown">
                                            <i class="bi bi-three-dots-vertical"></i>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" href="#">Edit</a></li>
                                            <li><a class="dropdown-item" href="#">Duplicate</a></li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li><a class="dropdown-item text-danger" href="#">Delete</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card-custom mb-4">
                        <div class="card-header">
                            <h6 class="mb-0">Workflow Stats</h6>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between mb-3">
                                <span>Active Workflows</span>
                                <strong>2</strong>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span>Total Executions</span>
                                <strong>0</strong>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Avg Completion Time</span>
                                <strong>-</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Approvals Section -->
        <div id="approvals-section" class="section d-none">
            <div class="page-header">
                <h4 class="mb-1">Pending Approvals</h4>
                <p class="text-muted mb-0">Review and approve service requests</p>
            </div>

            <div class="row g-4">
                <div class="col-lg-8">
                    <div class="card-custom">
                        <div class="card-body" id="approvals-list">
                            <div class="text-center text-muted py-5">
                                <i class="bi bi-check2-circle d-block mb-2" style="font-size: 3rem;"></i>
                                <p class="mb-0">No pending approvals</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card-custom">
                        <div class="card-header">
                            <h6 class="mb-0">Approval Summary</h6>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between mb-3">
                                <span>Pending</span>
                                <span class="badge bg-warning">0</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span>Approved Today</span>
                                <span class="badge bg-success">0</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Rejected Today</span>
                                <span class="badge bg-danger">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SLA Section -->
        <div id="sla-section" class="section d-none">
            <div class="page-header">
                <h4 class="mb-1">SLA Monitoring</h4>
                <p class="text-muted mb-0">Track service level agreements</p>
            </div>

            <div class="row g-4 mb-4">
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-value text-success" id="sla-within">0</div>
                        <div class="stat-label">Within SLA</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-value text-warning" id="sla-at-risk">0</div>
                        <div class="stat-label">At Risk</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-value text-danger" id="sla-breached">0</div>
                        <div class="stat-label">Breached</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-value" id="avg-resolution">-</div>
                        <div class="stat-label">Avg Resolution Time</div>
                    </div>
                </div>
            </div>

            <div class="card-custom">
                <div class="card-header">
                    <h6 class="mb-0">SLA Status by Request</h6>
                </div>
                <div class="card-body">
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-clock-history d-block mb-2" style="font-size: 2rem;"></i>
                        No active SLA tracking
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Section -->
        <div id="analytics-section" class="section d-none">
            <div class="page-header">
                <h4 class="mb-1">Analytics</h4>
                <p class="text-muted mb-0">Service request insights and reports</p>
            </div>

            <div class="row g-4 mb-4">
                <div class="col-md-6">
                    <div class="card-custom">
                        <div class="card-header">
                            <h6 class="mb-0">Requests by Status</h6>
                        </div>
                        <div class="card-body">
                            <canvas id="statusChart" height="200"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card-custom">
                        <div class="card-header">
                            <h6 class="mb-0">Requests by Type</h6>
                        </div>
                        <div class="card-body">
                            <canvas id="typeChart" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card-custom">
                <div class="card-header">
                    <h6 class="mb-0">Request Trend (Last 7 Days)</h6>
                </div>
                <div class="card-body">
                    <canvas id="trendChart" height="100"></canvas>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settings-section" class="section d-none">
            <div class="page-header">
                <h4 class="mb-1">Settings</h4>
                <p class="text-muted mb-0">Configure ServiceFlow settings</p>
            </div>

            <div class="row g-4">
                <div class="col-lg-8">
                    <div class="card-custom mb-4">
                        <div class="card-header">
                            <h6 class="mb-0">API Configuration</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">API Base URL</label>
                                <input type="text" class="form-control" id="api-url" value="http://localhost:3000/api/v1">
                            </div>
                            <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                            <button class="btn btn-outline-secondary ms-2" onclick="testConnection()">Test Connection</button>
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-header">
                            <h6 class="mb-0">SLA Configuration</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Default Response Time</label>
                                    <select class="form-select">
                                        <option value="1">1 hour</option>
                                        <option value="4" selected>4 hours</option>
                                        <option value="8">8 hours</option>
                                        <option value="24">24 hours</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Default Resolution Time</label>
                                    <select class="form-select">
                                        <option value="8">8 hours</option>
                                        <option value="24" selected>24 hours</option>
                                        <option value="48">48 hours</option>
                                        <option value="72">72 hours</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card-custom">
                        <div class="card-header">
                            <h6 class="mb-0">System Info</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-2"><small class="text-muted">Version</small><br><strong>1.0.0</strong></div>
                            <div class="mb-2"><small class="text-muted">Status</small><br><span class="badge bg-success">Online</span></div>
                            <div><small class="text-muted">Last Updated</small><br><strong id="last-updated">-</strong></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Service Modal -->
    <div class="modal fade" id="createServiceModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-plus-circle me-2"></i>New Service Request</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createServiceForm">
                        <div class="mb-3">
                            <label class="form-label">Title <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="service-title" placeholder="Brief description of your request" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="service-description" rows="4" placeholder="Detailed description of your service request" required></textarea>
                        </div>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Type</label>
                                <select class="form-select" id="service-type">
                                    <option value="general">General</option>
                                    <option value="it_support">IT Support</option>
                                    <option value="hr_request">HR Request</option>
                                    <option value="facilities">Facilities</option>
                                    <option value="procurement">Procurement</option>
                                    <option value="finance">Finance</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Priority</label>
                                <select class="form-select" id="service-priority">
                                    <option value="low">Low</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="high">High</option>
                                    <option value="critical">Critical</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Category</label>
                                <select class="form-select" id="service-category">
                                    <option value="">Select Category</option>
                                    <option value="hardware">Hardware</option>
                                    <option value="software">Software</option>
                                    <option value="network">Network</option>
                                    <option value="access">Access</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-outline-primary" onclick="saveAsDraft()">Save as Draft</button>
                    <button type="button" class="btn btn-primary" onclick="submitServiceRequest()">Submit Request</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Service Modal -->
    <div class="modal fade" id="viewServiceModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Service Request Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="view-service-content">
                    <!-- Content loaded dynamically -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script>
        // Configuration
        let API_BASE_URL = localStorage.getItem('apiUrl') || 'http://localhost:3000/api/v1';
        let socket = null;
        let services = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeNavigation();
            initializeSocket();
            loadDashboardData();
            initializeCharts();
            document.getElementById('last-updated').textContent = new Date().toLocaleString();
        });

        // Navigation
        function initializeNavigation() {
            document.querySelectorAll('.nav-link[data-section]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = link.getAttribute('data-section');
                    showSection(section);
                });
            });
        }

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => s.classList.add('d-none'));
            
            // Show selected section
            document.getElementById(`${sectionName}-section`).classList.remove('d-none');
            
            // Update nav links
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.querySelector(`.nav-link[data-section="${sectionName}"]`)?.classList.add('active');

            // Load section data
            if (sectionName === 'services') loadServices();
            if (sectionName === 'analytics') updateCharts();
        }

        // Socket.io
        function initializeSocket() {
            try {
                socket = io(API_BASE_URL.replace('/api/v1', ''), {
                    transports: ['websocket', 'polling']
                });

                socket.on('connect', () => {
                    console.log('Connected to ServiceFlow server');
                    showToast('Connected to server', 'success');
                });

                socket.on('service:created', (data) => {
                    showToast('New service request created', 'info');
                    loadDashboardData();
                });

                socket.on('service:updated', (data) => {
                    showToast('Service request updated', 'info');
                    loadDashboardData();
                });

                socket.on('approval:required', (data) => {
                    showToast('New approval required', 'warning');
                });

                socket.on('disconnect', () => {
                    console.log('Disconnected from server');
                });
            } catch (error) {
                console.log('Socket connection not available');
            }
        }

        // API Calls
        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };

                if (data) {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                return { success: false, error: error.message };
            }
        }

        // Dashboard
        async function loadDashboardData() {
            // Load stats
            const stats = await apiCall('/analytics/summary');
            if (stats.success) {
                document.getElementById('total-requests').textContent = stats.data?.totalRequests || 0;
                document.getElementById('pending-approvals').textContent = stats.data?.pendingApprovals || 0;
                document.getElementById('in-progress').textContent = stats.data?.inProgress || 0;
                document.getElementById('sla-compliance').textContent = (stats.data?.slaCompliance || 0) + '%';
            }

            // Load recent requests
            const result = await apiCall('/services?limit=5');
            if (result.success && result.data?.length > 0) {
                services = result.data;
                renderRecentRequests(result.data);
            }
        }

        function renderRecentRequests(requests) {
            const tbody = document.getElementById('recent-requests-table');
            
            if (!requests || requests.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="text-center text-muted py-4">No service requests yet</td></tr>`;
                return;
            }

            tbody.innerHTML = requests.map(req => `
                <tr>
                    <td><span class="service-id">#${req.id?.substring(0, 8) || 'N/A'}</span></td>
                    <td>${req.title}</td>
                    <td><span class="priority-badge priority-${req.priority}">${req.priority}</span></td>
                    <td><span class="status-badge status-${req.status}">${formatStatus(req.status)}</span></td>
                    <td>
                        <div class="sla-progress">
                            <div class="sla-progress-bar sla-safe" style="width: 60%"></div>
                        </div>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary btn-action" onclick="viewService('${req.id}')">
                            <i class="bi bi-eye"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Services
        async function loadServices() {
            const result = await apiCall('/services');
            if (result.success) {
                services = result.data || [];
                renderServicesTable(services);
            }
        }

        function renderServicesTable(data) {
            const tbody = document.getElementById('services-table-body');
            
            if (!data || data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="9" class="text-center text-muted py-5">No service requests found</td></tr>`;
                return;
            }

            tbody.innerHTML = data.map(req => `
                <tr>
                    <td><span class="service-id">#${req.id?.substring(0, 8) || 'N/A'}</span></td>
                    <td>${req.title}</td>
                    <td>${formatType(req.type)}</td>
                    <td><span class="priority-badge priority-${req.priority}">${req.priority}</span></td>
                    <td><span class="status-badge status-${req.status}">${formatStatus(req.status)}</span></td>
                    <td>${req.requester || 'System'}</td>
                    <td>${formatDate(req.createdAt)}</td>
                    <td>
                        <div class="sla-progress">
                            <div class="sla-progress-bar sla-safe" style="width: 60%"></div>
                        </div>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary btn-action me-1" onclick="viewService('${req.id}')" title="View">
                            <i class="bi bi-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-secondary btn-action" onclick="editService('${req.id}')" title="Edit">
                            <i class="bi bi-pencil"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Create Service
        function showCreateServiceModal() {
            document.getElementById('createServiceForm').reset();
            new bootstrap.Modal(document.getElementById('createServiceModal')).show();
        }

        async function submitServiceRequest() {
            const data = {
                title: document.getElementById('service-title').value,
                description: document.getElementById('service-description').value,
                type: document.getElementById('service-type').value,
                priority: document.getElementById('service-priority').value,
                category: document.getElementById('service-category').value,
                status: 'submitted'
            };

            if (!data.title || !data.description) {
                showToast('Please fill in all required fields', 'error');
                return;
            }

            const result = await apiCall('/services', 'POST', data);
            
            if (result.success) {
                showToast('Service request submitted successfully!', 'success');
                bootstrap.Modal.getInstance(document.getElementById('createServiceModal')).hide();
                loadDashboardData();
                loadServices();
            } else {
                showToast(result.message || 'Failed to submit request', 'error');
            }
        }

        async function saveAsDraft() {
            const data = {
                title: document.getElementById('service-title').value,
                description: document.getElementById('service-description').value,
                type: document.getElementById('service-type').value,
                priority: document.getElementById('service-priority').value,
                category: document.getElementById('service-category').value,
                status: 'draft'
            };

            if (!data.title) {
                showToast('Please enter a title', 'error');
                return;
            }

            const result = await apiCall('/services', 'POST', data);
            
            if (result.success) {
                showToast('Draft saved successfully!', 'success');
                bootstrap.Modal.getInstance(document.getElementById('createServiceModal')).hide();
                loadDashboardData();
            } else {
                showToast(result.message || 'Failed to save draft', 'error');
            }
        }

        // View Service
        async function viewService(id) {
            const service = services.find(s => s.id === id);
            
            if (service) {
                document.getElementById('view-service-content').innerHTML = `
                    <div class="mb-4">
                        <span class="service-id">#${id.substring(0, 8)}</span>
                        <span class="status-badge status-${service.status} ms-2">${formatStatus(service.status)}</span>
                        <span class="priority-badge priority-${service.priority} ms-2">${service.priority}</span>
                    </div>
                    <h5>${service.title}</h5>
                    <p class="text-muted">${service.description}</p>
                    <hr>
                    <div class="row">
                        <div class="col-md-6">
                            <small class="text-muted">Type</small>
                            <p>${formatType(service.type)}</p>
                        </div>
                        <div class="col-md-6">
                            <small class="text-muted">Created</small>
                            <p>${formatDate(service.createdAt)}</p>
                        </div>
                    </div>
                    <hr>
                    <h6>Workflow Progress</h6>
                    <div class="d-flex align-items-center gap-2 mt-3">
                        <div class="workflow-step completed" style="flex:1">
                            <i class="bi bi-check-circle text-success"></i>
                            <div><small>Created</small></div>
                        </div>
                        <i class="bi bi-chevron-right workflow-arrow"></i>
                        <div class="workflow-step ${service.status !== 'draft' ? 'completed' : ''}" style="flex:1">
                            <i class="bi bi-send"></i>
                            <div><small>Submitted</small></div>
                        </div>
                        <i class="bi bi-chevron-right workflow-arrow"></i>
                        <div class="workflow-step ${service.status === 'approved' || service.status === 'completed' ? 'completed' : ''}" style="flex:1">
                            <i class="bi bi-check2-square"></i>
                            <div><small>Approved</small></div>
                        </div>
                        <i class="bi bi-chevron-right workflow-arrow"></i>
                        <div class="workflow-step ${service.status === 'completed' ? 'completed' : ''}" style="flex:1">
                            <i class="bi bi-flag"></i>
                            <div><small>Completed</small></div>
                        </div>
                    </div>
                `;
                new bootstrap.Modal(document.getElementById('viewServiceModal')).show();
            }
        }

        // Filters
        function applyFilters() {
            const search = document.getElementById('search-input').value.toLowerCase();
            const status = document.getElementById('filter-status').value;
            const priority = document.getElementById('filter-priority').value;
            const type = document.getElementById('filter-type').value;

            let filtered = services.filter(s => {
                if (search && !s.title.toLowerCase().includes(search)) return false;
                if (status && s.status !== status) return false;
                if (priority && s.priority !== priority) return false;
                if (type && s.type !== type) return false;
                return true;
            });

            renderServicesTable(filtered);
        }

        // Charts
        let statusChart, typeChart, trendChart;

        function initializeCharts() {
            // Status Chart
            const statusCtx = document.getElementById('statusChart')?.getContext('2d');
            if (statusCtx) {
                statusChart = new Chart(statusCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Draft', 'Submitted', 'In Progress', 'Completed'],
                        datasets: [{
                            data: [0, 0, 0, 0],
                            backgroundColor: ['#9ca3af', '#3b82f6', '#6366f1', '#10b981']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { position: 'bottom' } }
                    }
                });
            }

            // Type Chart
            const typeCtx = document.getElementById('typeChart')?.getContext('2d');
            if (typeCtx) {
                typeChart = new Chart(typeCtx, {
                    type: 'bar',
                    data: {
                        labels: ['IT Support', 'HR', 'Facilities', 'Procurement', 'Other'],
                        datasets: [{
                            label: 'Requests',
                            data: [0, 0, 0, 0, 0],
                            backgroundColor: '#6366f1'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } }
                    }
                });
            }

            // Trend Chart
            const trendCtx = document.getElementById('trendChart')?.getContext('2d');
            if (trendCtx) {
                trendChart = new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: getLast7Days(),
                        datasets: [{
                            label: 'Requests',
                            data: [0, 0, 0, 0, 0, 0, 0],
                            borderColor: '#6366f1',
                            tension: 0.4,
                            fill: true,
                            backgroundColor: 'rgba(99, 102, 241, 0.1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } }
                    }
                });
            }
        }

        function updateCharts() {
            // Update charts with actual data if available
        }

        function getLast7Days() {
            const days = [];
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                days.push(d.toLocaleDateString('en-US', { weekday: 'short' }));
            }
            return days;
        }

        // Settings
        function saveSettings() {
            API_BASE_URL = document.getElementById('api-url').value;
            localStorage.setItem('apiUrl', API_BASE_URL);
            showToast('Settings saved successfully!', 'success');
        }

        async function testConnection() {
            try {
                const response = await fetch(API_BASE_URL.replace('/api/v1', '/health'));
                if (response.ok) {
                    showToast('Connection successful!', 'success');
                } else {
                    showToast('Connection failed', 'error');
                }
            } catch (error) {
                showToast('Connection failed: ' + error.message, 'error');
            }
        }

        // Utilities
        function formatStatus(status) {
            return status?.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) || 'Unknown';
        }

        function formatType(type) {
            return type?.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) || 'General';
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            return new Date(dateStr).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const id = 'toast-' + Date.now();
            
            const icons = {
                success: 'bi-check-circle-fill',
                error: 'bi-x-circle-fill',
                warning: 'bi-exclamation-triangle-fill',
                info: 'bi-info-circle-fill'
            };

            const bgColors = {
                success: 'bg-success',
                error: 'bg-danger',
                warning: 'bg-warning',
                info: 'bg-primary'
            };

            container.innerHTML += `
                <div id="${id}" class="toast show align-items-center text-white ${bgColors[type]} border-0" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="bi ${icons[type]} me-2"></i>${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;

            setTimeout(() => {
                document.getElementById(id)?.remove();
            }, 4000);
        }

        // Workflow Modal
        function showCreateWorkflowModal() {
            showToast('Workflow designer coming soon!', 'info');
        }

        // Edit Service
        function editService(id) {
            showToast('Edit functionality coming soon!', 'info');
        }
    </script>
</body>
</html>
